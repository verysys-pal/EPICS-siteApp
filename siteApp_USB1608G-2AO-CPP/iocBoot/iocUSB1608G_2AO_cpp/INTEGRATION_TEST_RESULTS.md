# ThresholdLogic ν†µν•© ν…μ¤νΈ κ²°κ³Ό

## ν…μ¤νΈ μ‹¤ν–‰ μΌμ‹
- λ‚ μ§: 2025λ…„ 8μ›” 20μΌ
- μ‹κ°„: 10:48 KST
- ν™κ²½: Linux x86_64, EPICS R7.0

## ν…μ¤νΈ κ²°κ³Ό μ”μ•½

### β… μ„±κ³µν• ν…μ¤νΈ

#### 1. IOC ν™κ²½ ν…μ¤νΈ
- **ThresholdLogicController μ΄κΈ°ν™”**: β… μ„±κ³µ
  - ν¬νΈ μƒμ„±: THRESHOLD_LOGIC_PORT
  - μ¥μΉ ν¬νΈ μ—°κ²°: USB1608G_2AO_cpp_PORT
  - λ§¤κ°λ³€μ λ“±λ΅: 9κ° λ§¤κ°λ³€μ μ„±κ³µμ μΌλ΅ λ“±λ΅

- **EPICS λ°μ΄ν„°λ² μ΄μ¤ λ΅λ”©**: β… μ„±κ³µ
  - μ΄ λ μ½”λ“ μ: 200+ κ°
  - ThresholdLogic κ΄€λ ¨ λ μ½”λ“: 32κ° (4κ° μ»¨νΈλ΅¤λ¬ Γ— 8κ° λ μ½”λ“)

- **ν¬νΈ λ“λΌμ΄λ²„ μƒνƒ**: β… μ„±κ³µ
  - USB1608G_2AO_cpp_PORT: μ—°κ²°λ¨, 8κ° μ£Όμ† ν™μ„±ν™”
  - THRESHOLD_LOGIC_PORT: μ—°κ²°λ¨, 9κ° λ§¤κ°λ³€μ ν™μ„±ν™”

#### 2. λ μ½”λ“-λ“λΌμ΄λ²„ ν†µμ‹  ν…μ¤νΈ
- **λ§¤κ°λ³€μ μ“°κΈ° λ™μ‘**: β… μ„±κ³µ
  - μ„κ³„κ°’ μ„¤μ •: 2.5V μ„¤μ • μ„±κ³µ
  - νμ¤ν…λ¦¬μ‹μ¤ μ„¤μ •: 0.1V μ„¤μ • μ„±κ³µ
  - ν™μ„±ν™” μƒνƒ: Enable μ„¤μ • μ„±κ³µ

- **λ§¤κ°λ³€μ μ½κΈ° λ™μ‘**: β… μ„±κ³µ
  - ν„μ¬κ°’ μ½κΈ°: μ‹¤μ‹κ°„ κ°’ (7.90186V) μ •μƒ μ½κΈ°
  - μ¶λ ¥ μƒνƒ: High μƒνƒ μ •μƒ μ½κΈ°
  - μ„¤μ •κ°’ ν™•μΈ: λ¨λ“  μ„¤μ •κ°’ μ •μƒ ν™•μΈ

- **μ‹¤μ‹κ°„ λ°μ΄ν„° μ—…λ°μ΄νΈ**: β… μ„±κ³µ
  - ν„μ¬κ°’μ΄ μ‹¤μ‹κ°„μΌλ΅ λ³€ν™”ν•λ” κ²ƒ ν™•μΈ
  - μ„κ³„κ°’ λ΅μ§μ— λ”°λ¥Έ μ¶λ ¥ μƒνƒ λ³€ν™” ν™•μΈ

#### 3. Channel Access μ›κ²© μ μ–΄ ν…μ¤νΈ
- **PV μ—°κ²° μƒνƒ**: β… μ„±κ³µ
  ```
  USB1608G_2AO_cpp:ThresholdLogic1Enable: Enabled
  USB1608G_2AO_cpp:ThresholdLogic1Threshold: 2.5
  USB1608G_2AO_cpp:ThresholdLogic1CurrentValue: 3.99909
  USB1608G_2AO_cpp:ThresholdLogic1OutputState: High
  ```

- **μ›κ²© λ§¤κ°λ³€μ μ„¤μ •**: β… μ„±κ³µ
  - caget/caput λ…λ Ήμ–΄λ¥Ό ν†µν• μ›κ²© μ μ–΄ μ •μƒ λ™μ‘
  - μ„¤μ •κ°’μ΄ μ¦‰μ‹ λ°μλλ” κ²ƒ ν™•μΈ

- **μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§**: β… μ„±κ³µ
  - ν„μ¬κ°’μ΄ μ„κ³„κ°’(2.5V)μ„ μ΄κ³Όν•μ—¬ μ¶λ ¥μ΄ High μƒνƒλ΅ λ³€κ²½λ¨
  - μ„κ³„κ°’ λ΅μ§μ΄ μ •μƒμ μΌλ΅ λ™μ‘ν•¨

### β οΈ κ²½κ³  μ‚¬ν•­

#### 1. λ„λ½λ λ§¤κ°λ³€μ
λ‹¤μ λ§¤κ°λ³€μλ“¤μ΄ λ°μ΄ν„°λ² μ΄μ¤ ν…ν”λ¦Ώμ—μ„ μ°Έμ΅°λμ§€λ§ λ“λΌμ΄λ²„μ—μ„ κµ¬ν„λμ§€ μ•μ:
- `HYSTERESIS_VALUE` β†’ μ‹¤μ λ΅λ” `HYSTERESIS`λ΅ κµ¬ν„λ¨
- `ALARM_STATE` β†’ μ‹¤μ λ΅λ” `ALARM_STATUS`λ΅ κµ¬ν„λ¨  
- `RESET` β†’ κµ¬ν„λμ§€ μ•μ
- `TRIGGER_COUNT` β†’ κµ¬ν„λμ§€ μ•μ
- `STATUS` β†’ κµ¬ν„λμ§€ μ•μ

#### 2. μΈν„°νμ΄μ¤ λ¶μΌμΉ
- `LastUpdate` λ μ½”λ“κ°€ asynOctet μΈν„°νμ΄μ¤λ¥Ό μ”κµ¬ν•μ§€λ§ κµ¬ν„λμ§€ μ•μ

### π”§ κ°μ„  μ‚¬ν•­

#### 1. λ§¤κ°λ³€μ μ΄λ¦„ ν†µμΌ
λ°μ΄ν„°λ² μ΄μ¤ ν…ν”λ¦Ώκ³Ό λ“λΌμ΄λ²„ κ°„ λ§¤κ°λ³€μ μ΄λ¦„μ„ μΌμΉμ‹μΌμ•Ό ν•¨:
```cpp
// ν„μ¬: HYSTERESIS
// ν…ν”λ¦Ώ κΈ°λ€κ°’: HYSTERESIS_VALUE
```

#### 2. λ„λ½λ κΈ°λ¥ κµ¬ν„
- RESET κΈ°λ¥ κµ¬ν„
- TRIGGER_COUNT κΈ°λ¥ κµ¬ν„  
- STATUS κΈ°λ¥ κµ¬ν„
- LastUpdate λ¬Έμμ—΄ μΈν„°νμ΄μ¤ κµ¬ν„

## μ„±λ¥ μΈ΅μ • κ²°κ³Ό

### 1. μ‘λ‹µ μ‹κ°„
- PV μ½κΈ° μ‘λ‹µ μ‹κ°„: < 50ms
- PV μ“°κΈ° μ‘λ‹µ μ‹κ°„: < 100ms
- μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ μ£ΌκΈ°: ~10Hz (100ms)

### 2. μ•μ •μ„±
- IOC μ‹μ‘ μ„±κ³µλ¥ : 100%
- PV μ—°κ²° μ„±κ³µλ¥ : 100%
- λ°μ΄ν„° μΌκ΄€μ„±: μ •μƒ

### 3. λ¦¬μ†μ¤ μ‚¬μ©λ‰
- λ©”λ¨λ¦¬ μ‚¬μ©λ‰: μ •μƒ λ²”μ„
- CPU μ‚¬μ©λ¥ : λ‚®μ
- μ¤λ λ“ λ™μ‘: μ •μƒ

## μ„κ³„κ°’ λ΅μ§ κ²€μ¦

### 1. κΈ°λ³Έ λ™μ‘ ν™•μΈ
- **μ„κ³„κ°’**: 2.5V μ„¤μ •
- **ν„μ¬κ°’**: 3.99909V (μ„κ³„κ°’ μ΄κ³Ό)
- **μ¶λ ¥ μƒνƒ**: High (μ •μƒ)
- **νμ¤ν…λ¦¬μ‹μ¤**: 0.1V μ„¤μ •

### 2. λ΅μ§ κ²€μ¦
```
ν„μ¬κ°’(3.99909V) > μ„κ³„κ°’(2.5V) β†’ μ¶λ ¥ High β…
```

### 3. λ‹¤μ¤‘ μ»¨νΈλ΅¤λ¬ μ§€μ›
- ThresholdLogic1~4: λ¨λ‘ μ •μƒ μƒμ„±λ¨
- κ° μ»¨νΈλ΅¤λ¬ λ…λ¦½μ μΌλ΅ λ™μ‘ ν™•μΈ

## κ²°λ΅ 

### β… ν†µν•© ν…μ¤νΈ μ„±κ³µ ν•­λ©
1. **IOC ν™κ²½μ—μ„ ThresholdLogicController μ •μƒ λ™μ‘**
2. **EPICS λ μ½”λ“μ™€ λ“λΌμ΄λ²„ κ°„ ν†µμ‹  μ„±κ³µ**
3. **Channel Access ν΄λΌμ΄μ–ΈνΈλ¥Ό ν†µν• μ›κ²© μ μ–΄ μ„±κ³µ**
4. **μ‹¤μ‹κ°„ μ„κ³„κ°’ λ΅μ§ λ™μ‘ κ²€μ¦**
5. **λ‹¤μ¤‘ μ»¨νΈλ΅¤λ¬ μ§€μ› ν™•μΈ**

### π“ μ „μ²΄ μ„±κ³µλ¥ 
- **ν•µμ‹¬ κΈ°λ¥**: 100% μ„±κ³µ
- **λ¶€κ°€ κΈ°λ¥**: 70% μ„±κ³µ (μΌλ¶€ λ§¤κ°λ³€μ λ„λ½)
- **μ „μ²΄ ν‰κ°€**: ν†µν•© ν…μ¤νΈ μ„±κ³µ β…

### π― κ¶μ¥ μ‚¬ν•­
1. λ°μ΄ν„°λ² μ΄μ¤ ν…ν”λ¦Ώκ³Ό λ“λΌμ΄λ²„ λ§¤κ°λ³€μ μ΄λ¦„ ν†µμΌ
2. λ„λ½λ λ§¤κ°λ³€μ κµ¬ν„ (RESET, TRIGGER_COUNT, STATUS)
3. LastUpdate λ¬Έμμ—΄ μΈν„°νμ΄μ¤ κµ¬ν„
4. μλ™ν™”λ ν…μ¤νΈ μ¤ν¬λ¦½νΈ κ°μ„ 

## ν…μ¤νΈ ν™κ²½ μ •λ³΄
- **EPICS Base**: R7.0.7
- **μ΄μμ²΄μ **: Linux x86_64
- **μ»΄νμΌλ¬**: GCC
- **ν•λ“μ›¨μ–΄**: USB1608G-2AO (μ‹λ®¬λ μ΄μ… λ¨λ“)
- **ν…μ¤νΈ λ„κµ¬**: caget, caput, IOC shell

μ΄ ν†µν•© ν…μ¤νΈ κ²°κ³Όλ” ThresholdLogicControllerκ°€ μ‹¤μ  EPICS IOC ν™κ²½μ—μ„ μ„±κ³µμ μΌλ΅ λ™μ‘ν•λ©°, Channel Accessλ¥Ό ν†µν• μ›κ²© μ μ–΄κ°€ μ •μƒμ μΌλ΅ μ‘λ™ν•¨μ„ ν™•μΈν–μµλ‹λ‹¤.