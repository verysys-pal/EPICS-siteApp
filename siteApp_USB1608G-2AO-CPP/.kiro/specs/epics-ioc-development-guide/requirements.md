# EPICS IOC 프로젝트 개발 가이드 요구사항

## 소개

이 문서는 USB1608G-2AO 장치를 위한 완전한 EPICS IOC 프로젝트 개발 가이드를 정의합니다. 자동 임계값 기반 로직 제어(Automatic Threshold Logic Control)를 포함한 전체 개발 프로세스를 체계화합니다.

## 요구사항

### 요구사항 1: 프로젝트 구조 가이드

**사용자 스토리:** 개발자로서 EPICS IOC 프로젝트의 표준 구조를 이해하고 올바른 순서로 파일을 수정할 수 있도록 가이드가 필요합니다.

#### 승인 기준
1. **WHEN** 개발자가 새로운 EPICS IOC 프로젝트를 시작할 때 **THEN** 시스템은 표준 디렉토리 구조를 제공해야 합니다
2. **WHEN** 파일 수정이 필요할 때 **THEN** 시스템은 올바른 수정 순서를 명시해야 합니다
3. **WHEN** 빌드 오류가 발생할 때 **THEN** 시스템은 문제 해결 순서를 제공해야 합니다

### 요구사항 2: 파일 의존성 관계 문서화

**사용자 스토리:** 개발자로서 EPICS IOC 프로젝트 내 파일들 간의 의존성 관계를 명확히 이해하여 효율적으로 개발할 수 있어야 합니다.

#### 승인 기준
1. **WHEN** 파일을 수정할 때 **THEN** 시스템은 영향받는 다른 파일들을 식별해야 합니다
2. **WHEN** 새로운 기능을 추가할 때 **THEN** 시스템은 수정해야 할 파일 목록을 제공해야 합니다
3. **WHEN** 빌드 시스템을 구성할 때 **THEN** 시스템은 Makefile 의존성을 명확히 설명해야 합니다

### 요구사항 3: 개발 명세서 작성

**사용자 스토리:** 프로젝트 관리자로서 완전한 개발 명세서를 통해 프로젝트 진행 상황을 추적하고 품질을 보장할 수 있어야 합니다.

#### 승인 기준
1. **WHEN** 프로젝트를 시작할 때 **THEN** 시스템은 기술 스택과 아키텍처를 문서화해야 합니다
2. **WHEN** 개발이 진행될 때 **THEN** 시스템은 각 컴포넌트의 역할과 인터페이스를 명세해야 합니다
3. **WHEN** 테스트가 필요할 때 **THEN** 시스템은 테스트 계획과 검증 방법을 제공해야 합니다

### 요구사항 4: 자동 임계값 로직 제어 구현 가이드

**사용자 스토리:** 개발자로서 ThresholdLogicController 클래스를 올바르게 구현하고 EPICS 시스템에 통합할 수 있는 상세한 가이드가 필요합니다.

#### 승인 기준
1. **WHEN** ThresholdLogicController를 구현할 때 **THEN** 시스템은 asynPortDriver 상속 방법을 설명해야 합니다
2. **WHEN** 실시간 모니터링을 구현할 때 **THEN** 시스템은 epicsThread 사용법을 제공해야 합니다
3. **WHEN** IOC 쉘 명령어를 추가할 때 **THEN** 시스템은 iocsh 등록 방법을 설명해야 합니다

### 요구사항 5: 빌드 시스템 최적화 가이드

**사용자 스토리:** 개발자로서 EPICS 빌드 시스템을 효율적으로 구성하고 일반적인 빌드 오류를 해결할 수 있는 가이드가 필요합니다.

#### 승인 기준
1. **WHEN** Makefile을 작성할 때 **THEN** 시스템은 EPICS 빌드 규칙을 설명해야 합니다
2. **WHEN** 라이브러리 의존성을 추가할 때 **THEN** 시스템은 올바른 링킹 방법을 제공해야 합니다
3. **WHEN** 컴파일 오류가 발생할 때 **THEN** 시스템은 일반적인 해결 방법을 제시해야 합니다

### 요구사항 6: 데이터베이스 템플릿 설계 가이드

**사용자 스토리:** 개발자로서 EPICS 데이터베이스 템플릿과 치환 파일을 올바르게 설계하고 구현할 수 있는 가이드가 필요합니다.

#### 승인 기준
1. **WHEN** 새로운 레코드 타입을 추가할 때 **THEN** 시스템은 템플릿 작성 방법을 설명해야 합니다
2. **WHEN** 치환 파일을 작성할 때 **THEN** 시스템은 매개변수 전달 방법을 제공해야 합니다
3. **WHEN** 레코드 간 연결이 필요할 때 **THEN** 시스템은 링크 설정 방법을 설명해야 합니다

### 요구사항 7: 파일변경 범위

**사용자 스토리:** 개발자로서 EPICS 파일변경 범위를 설계하고 구현할 수 있는 가이드가 필요합니다.

1. USB1608G_2AO_cpp/USB1608G_2AO_cppApp/src 폴더의 파일들을 수정하면 안됩니다.
2. USB1608G_2AO_cpp/USB1608G_2AO_cppApp/src 폴더의 파일들을 참고하고, 
   ThresholdLogicController.cpp ThresholdLogicController.cpp.h 파일은 요구 사항에 대한 기능을 구현합니다.
3. USB1608G_2AO_cpp/USB1608G_2AO_cppApp/Db 템플릿 파일을 참고하고 새로운 템플리 파일을 만들어야 합니다.
4. USB1608G_2AO_cpp/USB1608G_2AO_cppApp/Db/USB1608G_2AO.substitutions 파일에 새로운 템플릿을 치환합니다.
   기존 내용들은 보존합니다. 

### 요구사항 8: MEDM 생성 및 시험용 스크립트 작성
**사용자 스토리:** 개발자로서 EPICS MEDM 생성 및 시험용 스크립트를 작성할 수 있는 가이드가 필요합니다.

1. 기존 화면 보존
   - USB1608G_2AO_cppApp/op/USB1608G_2AO_cpp.adl 파일의 기존 MEDM 화면 내용은 그대로 유지.
2. 버튼 생성 (ThresholdLogicController.cpp 로직 반영)
   - USB1608G_2AO_cppApp/op/USB1608G_2AO_cpp.adl 파일에 ThresholdLogicController.cpp 에서 구현한 버튼 로직을 MEDM 화면에 추가.
   - 각 버튼은 EPICS PV와 연결되며, 로직 기반 제어가 가능해야 함.
3. 시험용 스크립트 작성
   - USB1608G_2AO_cpp/iocBoot/iocUSB1608G_2AO_cpp/catest_USB1608G_2AO.sh 의 스타일을 참고.
   - 신규 버튼 및 PV 동작을 시험할 수 있도록 catest_ThresholdLogic.sh (예시) 스크립트를 작성.
   - 스크립트는 caget, caput, camonitor 등을 활용하여 버튼 동작 및 로직 결과를 확인할 수 있도록 구성.

